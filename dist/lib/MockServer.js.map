{"version":3,"file":"MockServer.js","sourceRoot":"","sources":["../../src/lib/MockServer.ts"],"names":[],"mappings":"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","sourcesContent":["import * as express from 'express';\r\nconst server = express();\r\nimport * as bodyParser from 'body-parser';\r\nimport * as _ from 'lodash';\r\nimport * as hash from 'object-hash';\r\nimport * as httpProxy from 'http-proxy';\r\nimport * as qs from 'querystring';\r\nimport {Logger} from './Logger';\r\nimport {ParsedTestSuite} from \"../config/parsed/ParsedTestSuiteConfig\";\r\nimport {BusybeeParsedConfig} from \"../config/BusybeeParsedConfig\";\r\nimport {MockServerConfig} from \"../config/common/MockServerConfig\";\r\n\r\nexport class MockServer {\r\n\r\n  private conf: any;\r\n  private testSuiteConf: any;\r\n  private logger: Logger;\r\n  private routeMap: any;\r\n  private proxy: any;\r\n\r\n  constructor(testSuiteConf: ParsedTestSuite, conf: BusybeeParsedConfig) {\r\n    this.conf = conf;\r\n    this.testSuiteConf = testSuiteConf;\r\n    this.logger = new Logger(conf, this);\r\n    this.logger.info('Initializing Mock Server');\r\n    this.routeMap = {}; // store the routes and all of the known request combos for each route\r\n\r\n    let serverConf:MockServerConfig = this.testSuiteConf.mockServer;\r\n    if (serverConf && serverConf.proxy && (conf.cmdOpts && !conf.cmdOpts)) {\r\n      if (!serverConf.proxy.protocol || !serverConf.proxy.host || !serverConf.proxy.port) {\r\n        this.logger.warn(`WARNING: mockServer proxy configuration does not contain required properties 'protocol', 'host' and 'port' \\n Requests will not be proxied`);\r\n      } else {\r\n        let proto = serverConf.proxy.protocol;\r\n        let host = serverConf.proxy.host;\r\n        let port = serverConf.proxy.port;\r\n        this.logger.info(`Creating proxy: ${proto}://${host}:${port}`);\r\n        this.proxy = new httpProxy.createProxyServer({\r\n          target: {\r\n            host: serverConf.proxy.host,\r\n            port: serverConf.proxy.port\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    server.set('etag', false);\r\n    server.use(bodyParser.json()); // for parsing application/json\r\n    server.use(bodyParser.urlencoded({ extended: true })); // for parsing application/x-www-form-urlencoded\r\n    if (this.corsActive()) {\r\n      server.use((req, res, next) => {\r\n        res.append('Access-Control-Allow-Origin', req.header('origin'));\r\n        res.append('Access-Control-Allow-Credentials', true);\r\n        next();\r\n      });\r\n    }\r\n    this.buildRoutes();\r\n\r\n    let port = this.getServerPort();\r\n    server.listen(port, () => {\r\n      this.logger.info(`Mock Server listening on ${port}`)\r\n    });\r\n  }\r\n\r\n  getServerPort() {\r\n    let conf = this.testSuiteConf;\r\n    let port = conf.port;\r\n    if (conf.mockServer && conf.mockServer.port) {\r\n      port = conf.mockServer.port;\r\n    }\r\n\r\n    return port;\r\n  }\r\n\r\n  corsActive() {\r\n    return this.testSuiteConf.mockServer.cors !== false\r\n  }\r\n\r\n  buildRoutes() {\r\n    // setup cors by default\r\n    if (this.corsActive()) {\r\n      this.logger.debug('CORS active');\r\n\r\n      server.options('*', (req, res, next) => {\r\n        let headers = {\r\n          'busybee-mock': true,\r\n          'Access-Control-Allow-Methods': 'GET,POST,DELETE,PUT,OPTIONS',\r\n          'Access-Control-Allow-Headers': req.header('Access-Control-Request-Headers'),\r\n          'Access-Control-Max-Age': 86400\r\n        }\r\n\r\n        _.forEach(headers, (v, k) => {\r\n          res.append(k, v);\r\n        });\r\n\r\n        return res.status(200).end();\r\n      });\r\n    }\r\n\r\n    // build the routeMap\r\n    this.testSuiteConf.testEnvs.forEach((testEnv, envId) => {\r\n      testEnv.testSets.forEach((testSet, testSetName) => {\r\n        testSet.tests.forEach((mock) => {\r\n          this.updateRouteMap(mock);\r\n        });\r\n      });\r\n    })\r\n\r\n    // iterate the routeMap and register each route to the server\r\n    _.each(this.routeMap, (reqMethodMap, endpoint) => {\r\n      this.addRoute(endpoint, reqMethodMap);\r\n    });\r\n\r\n    // add a special catchall route for the proxy if necessary\r\n    if (this.proxy) {\r\n      server.all('*', (req, res, next) => {\r\n        this.logger.info('No Mock found, proxying request');\r\n        this.logger.info(`${req.method} ${req.originalUrl}`);\r\n        // if a call makes it here then it just needs to be proxied\r\n        req = this.injectRequestOpts(req);\r\n        this.proxy.web(req, res);\r\n      });\r\n    }\r\n  }\r\n\r\n  // build an endpoint that accounts for the root context\r\n  getEndpoint(mock) {\r\n    let endpoint = mock.request.endpoint;\r\n    if (!_.isUndefined(mock.request.root)) {\r\n      if (mock.request.root != null) { // allow users to set request.root to false to override mockServer.root && testSuiteConf.root when mocking\r\n        endpoint = `${mock.request.root}${endpoint}`;\r\n      }\r\n    } else if (!_.isUndefined(this.testSuiteConf.mockServer.root)) {\r\n      if (this.testSuiteConf.mockServer.root != null) { // allow users to set mockServer.root to false to override testSuiteConf.root when mocking\r\n        endpoint = `${this.testSuiteConf.mockServer.root}${endpoint}`;\r\n      }\r\n    } else if (this.testSuiteConf.root) {\r\n      endpoint = `${this.testSuiteConf.root}${endpoint}`;\r\n    }\r\n\r\n    return endpoint;\r\n  }\r\n\r\n  updateRouteMap(mock) {\r\n    // // update the mock with the globally applied headers according to the conf. (if any)\r\n    // if (this.testSuiteConf.mockServer.injectedRequestOpts) {\r\n    //   delete this.testSuiteConf.mockServer.injectedRequestOpts['description'];\r\n    //   mock.request = Object.assign({}, this.testSuiteConf.mockServer.injectedRequestOpts, mock.request);\r\n    // }\r\n\r\n    // build an endpoint that accounts for the root context\r\n    let endpoint = this.getEndpoint(mock);\r\n    if (!this.routeMap[endpoint]) {\r\n      this.routeMap[endpoint] = {\r\n        get: {200:[]},\r\n        post: {200:[]},\r\n        put: {200:[]},\r\n        delete: {200:[]},\r\n        head: {200:[]},\r\n        options: {200:[]}\r\n      };\r\n    }\r\n    // 1. see if this req has already been recorded (could be in multiple sets)\r\n    let request = mock.request;\r\n    let requestOpts = this.buildReqOpts(request);\r\n    // query params come into the controller as strings ALWAYS. so make sure our mock query params are string\r\n    if (requestOpts.query) {\r\n      requestOpts.query = this.convertObjValuesToStrings(requestOpts.query);\r\n    }\r\n\r\n    let hashedReq = hash(requestOpts);\r\n    // 1a. search the this.routeMap[test.request.endpoint] for it using the hash\r\n    let method = request.method.toLocaleLowerCase();\r\n    let resStatus = mock.expect.status;\r\n    if (this.routeMap[endpoint][method]) {\r\n      if (this.routeMap[endpoint][method][resStatus]) {\r\n        if (_.find(this.routeMap[endpoint][method], (reqInfo) => { reqInfo.hash === hashedReq})) {\r\n          // skip this one it exists\r\n          return\r\n        }\r\n      } else {\r\n        this.routeMap[endpoint][method][resStatus] = []\r\n      }\r\n    } else {\r\n      this.logger.info(`The method ${method} is not currently support for mocks`);\r\n      return\r\n    }\r\n\r\n    // 2. register the request info for this route\r\n    this.routeMap[endpoint][method][resStatus].push(Object.assign({}, mock, {hash: hashedReq}, {matcherOpts: requestOpts}));\r\n  }\r\n\r\n  addRoute(endpoint, reqMethodMap) {\r\n    this.logger.debug(`addRoute ${endpoint}, ${JSON.stringify(reqMethodMap)}`);\r\n\r\n    _.forEach(reqMethodMap, (statusMap, methodName) => {\r\n      // 1. build a controller\r\n      let ctrl = (req, res) => {\r\n        // First we check to see if the requester wants a mock with a specific status. If not, we default to 200\r\n        let requestedStatus = 200;\r\n        if (req.header('busybee-mock-status')) {\r\n          requestedStatus = parseInt(req.header('busybee-mock-status'));\r\n          if (!_.isInteger(requestedStatus)) {\r\n            return res.status(404).send(`busybee-mock-status must be an Integer, was '${req.header('busybee-mock-status')}'`)\r\n          }\r\n        }\r\n\r\n        // get the mocks for this statusCode\r\n        let mocks = statusMap[requestedStatus];\r\n        let reqOpts = this.buildReqOpts(req);\r\n        this.logger.debug('INCOMING REQ OPTS');\r\n        this.logger.debug(reqOpts, true);\r\n        let hashedReq = hash(reqOpts);\r\n\r\n        // find all mocks for this route and method that have the same hash of query/body params\r\n        let matchingMocks = _.filter(mocks, (m) => {\r\n          this.logger.debug('TESTING AGAINST');\r\n          this.logger.debug(m.matcherOpts, true);\r\n          this.logger.debug(`${m.hash} == ${hashedReq}`);\r\n          return m.hash === hashedReq;\r\n        });\r\n\r\n        if (!matchingMocks || matchingMocks.length === 0) {\r\n          if (this.proxy) {\r\n            this.proxy.web(req, res);\r\n          } else {\r\n            res.status(404).end();\r\n          }\r\n          return;\r\n        }\r\n\r\n        /*\r\n         now we need to inspect the headers. our mock may only care about 1 or 2 headers\r\n         but a request can have many more and therfore we can't just hash the whole thing\r\n         and use that to compare on. we need to look for just the ones\r\n         mentioned in the mock.\r\n        */\r\n        let mocksWithoutHeaders = [];\r\n        let mocksWithHeaders = [];\r\n        matchingMocks.forEach((m) => {\r\n          this.logger.debug('checking mock');\r\n          // mocks that don't have headers defined don't need to match. IF this array only has 1 item\r\n          // and we don't have any addition matchingMocks with header needs, it will get returned as a default.\r\n          if (!m.request.headers) {\r\n            // mock doesn't require any headers, it passes\r\n            this.logger.debug(`mock doesn't require any headers`);\r\n            return mocksWithoutHeaders.push(m);\r\n          }\r\n\r\n          // inject any request opts\r\n          req = this.injectRequestOpts(req);\r\n          let reqHeaders = req.headers;\r\n\r\n          // to remove comparison errors, convert numbers to strings in both header objs\r\n          reqHeaders = this.convertObjValuesToStrings(reqHeaders); // convert any numbers to strings\r\n          let mockHeaders = this.convertObjValuesToStrings(m.request.headers);  // convert any numbers to strings\r\n          this.logger.debug('mockHeaders');\r\n          this.logger.debug(mockHeaders, true);\r\n          let headersPass = true;\r\n          _.forEach(mockHeaders, (value, headerName) => {\r\n            if (value == null) {\r\n              // if the header is null then that implies that we don't want to check for this header\r\n              this.logger.debug(`mock headerName ${headerName} set to null, skipping match attempt`);\r\n              return;\r\n            }\r\n            if (reqHeaders[headerName] !== value) {\r\n              this.logger.debug(`${headerName} - ${reqHeaders[headerName]} !== ${value}`);\r\n              headersPass = false;\r\n            }\r\n          });\r\n          if (headersPass) {\r\n            this.logger.debug(`Mock Passes - ${m.name}`);\r\n            mocksWithHeaders.push(m);\r\n          }\r\n        });\r\n\r\n\r\n        let mockToReturn;\r\n        this.logger.debug(\"mocksWithoutHeaders\");\r\n        this.logger.debug(mocksWithoutHeaders, true);\r\n        this.logger.debug(\"mocksWithHeaders\");\r\n        this.logger.debug(mocksWithHeaders, true);\r\n        if (mocksWithHeaders.length == 1) {\r\n          // mocksWithHeaders matched more deeply with the request (query+body+headers)\r\n          // we should prioritize these if we have an exact match\r\n          mockToReturn = mocksWithHeaders[0];\r\n        }\r\n        else if (mocksWithoutHeaders.length == 1) {\r\n          // see if we have a single mock without headers\r\n          mockToReturn = mocksWithoutHeaders[0];\r\n        } else {\r\n          if (this.proxy) {\r\n            this.logger.info(\"No mock matches request but proxy available. Proxying request\");\r\n            return this.proxy.web(req, res);\r\n          } else {\r\n            if (mocksWithoutHeaders.length == 0 && mocksWithHeaders.length == 0) {\r\n              let message = \"This request did not match any mocks and no proxy is available.\";\r\n              return res.status(404).json({ err: message });\r\n            } else {\r\n              let message = \"This request is ambiguous due to multiple mocks sharing the name header requirements.\";\r\n              return res.status(404).json({\r\n                err: message,\r\n                mocksInQuestion: mocksWithoutHeaders.concat(mocksWithHeaders)\r\n              });\r\n            }\r\n          }\r\n        }\r\n\r\n        // set headers\r\n        res.append('busybee-mock', true);\r\n        let resHeaders;\r\n        if (mockToReturn.expect.headers) {\r\n          resHeaders = Object.assign({}, resHeaders, mockToReturn.expect.headers);\r\n        }\r\n        if (mockToReturn.expect.headers) {\r\n          _.forEach(resHeaders, (v,k) => {\r\n            if (v == null) { return; }\r\n            res.append(k,v);\r\n          });\r\n        }\r\n\r\n        this.logger.debug(JSON.stringify(mockToReturn.expect.body));\r\n        return res.status(mockToReturn.expect.status).json(mockToReturn.expect.body);\r\n      } // end ctrl\r\n\r\n      // 2. register the route/method and ctrl\r\n      this.logger.info(`Registering endpoint ${endpoint} : ${methodName}`);\r\n      server[methodName](endpoint, ctrl);\r\n    });\r\n  }\r\n\r\n  buildReqOpts(req): any {\r\n    let opts = <any>{};\r\n\r\n    if (!_.isEmpty(req.query)) {\r\n      opts.query = req.query\r\n    }\r\n\r\n    if (!_.isEmpty(req.body)) {\r\n      opts.body = req.body\r\n    }\r\n\r\n    return opts;\r\n  }\r\n\r\n  convertObjValuesToStrings(obj) {\r\n    let newObj = {}\r\n    _.forEach(obj, (value, key) => {\r\n      if (_.isObject(value)) {\r\n        newObj[key] = this.convertObjValuesToStrings(value);\r\n      } else {\r\n        if (!_.isNil(value)) {\r\n          newObj[key] = value.toString();\r\n          if (newObj[key]) {\r\n            newObj[key] = qs.unescape(newObj[key])\r\n          }\r\n        } else {\r\n          newObj[key] = value;\r\n        }\r\n      }\r\n    });\r\n\r\n    return newObj;\r\n  }\r\n\r\n  injectRequestOpts(req) {\r\n    let mockServerConf = this.testSuiteConf.mockServer;\r\n\r\n    if (mockServerConf.injectedRequestOpts) {\r\n      ['headers', 'query', 'body'].forEach((target) => {\r\n        if (mockServerConf.injectedRequestOpts[target]) {\r\n          this.logger.debug(`injectedRequestOpts.${target} detected. Injecting ${target}`);\r\n          req[target] = Object.assign({}, mockServerConf.injectedRequestOpts[target], req[target]);\r\n          this.logger.debug(`${target} injected`);\r\n          this.logger.debug(req[target], true);\r\n        }\r\n      });\r\n    }\r\n\r\n    return req;\r\n  }\r\n}\r\n"]}