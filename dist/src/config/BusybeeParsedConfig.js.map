{"version":3,"file":"BusybeeParsedConfig.js","sourceRoot":"","sources":["../../../src/config/BusybeeParsedConfig.ts"],"names":[],"mappings":"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","sourcesContent":["import * as uuidv1 from 'uuid/v1';\r\nimport {TestSuiteConfig} from \"./user/TestSuiteConfig\";\r\nimport {BusybeeUserConfig} from \"./BusybeeUserConfig\";\r\nimport {Logger} from \"../lib/Logger\";\r\nimport * as glob from 'glob';\r\nimport * as fs from 'fs';\r\nimport * as _ from 'lodash';\r\nimport * as path from 'path';\r\nimport {EnvResourceConfig} from \"./common/EnvResourceConfig\";\r\nimport {ParsedTestSuite} from \"./parsed/ParsedTestSuiteConfig\";\r\nimport {FilePathsConfig} from \"./parsed/FilePathsConfig\";\r\nimport {TypedMap} from \"../lib/TypedMap\";\r\nimport {RESTTest} from \"./test/RESTTest\";\r\n\r\nexport class BusybeeParsedConfig {\r\n  private logger: Logger;\r\n  private testSet2EnvMap = new TypedMap<string>();\r\n  private env2TestSuiteMap = new TypedMap<string>();\r\n  private testFiles: string[];\r\n  private skipTestSuites: string[];\r\n\r\n  filePaths: FilePathsConfig;\r\n  cmdOpts: any;\r\n  logLevel: string;\r\n  parsedTestSuites: TypedMap<ParsedTestSuite>;\r\n  envResources: EnvResourceConfig[];\r\n  onComplete: string;\r\n\r\n  constructor(userConfig: BusybeeUserConfig, cmdOpts: any, mode: string) {\r\n    this.cmdOpts = cmdOpts;\r\n    this.parseCmdOpts();\r\n    this.logLevel = this.getLogLevel(cmdOpts);\r\n    this.logger = new Logger({logLevel: this.logLevel}, this);\r\n    this.filePaths = new FilePathsConfig(cmdOpts);\r\n    this.onComplete = userConfig.onComplete;\r\n    this.parsedTestSuites = this.parseTestSuites(userConfig, mode);\r\n    this.envResources = userConfig.envResources;\r\n\r\n    if (cmdOpts.localMode) {\r\n      this.logger.info(`LocalMode detected. Host Configuration will be ignored in favor of 'localhost'`);\r\n    }\r\n  }\r\n\r\n  parseCmdOpts() {\r\n    if (this.cmdOpts.skipTestSuite) {\r\n      this.skipTestSuites = this.cmdOpts.skipTestSuite.split(',');\r\n    }\r\n    if (this.cmdOpts.testFiles) {\r\n      this.testFiles = this.cmdOpts.testFiles.split(',');\r\n    }\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      parsedTestSuites: this.parsedTestSuites,\r\n      envResources: this.envResources,\r\n      logLevel: this.logLevel\r\n    }\r\n  }\r\n\r\n  getTestSet2EnvMap(): TypedMap<string> {\r\n    return this.testSet2EnvMap;\r\n  }\r\n\r\n  getEnv2TestSuiteMap(): TypedMap<string> {\r\n    return this.env2TestSuiteMap;\r\n  }\r\n\r\n  parseTestSuites(userConf: BusybeeUserConfig, mode: string): TypedMap<ParsedTestSuite> {\r\n    let parsedTestSuites = new TypedMap<ParsedTestSuite>();\r\n    // see if the user specified to skip testSuites\r\n\r\n    // TODO: figure out why we can only pass 1 testSuite when in mockResponse mode. in theory we should be able to parse all\r\n    // test suites regardless of mode. However, if we do...for some reason the test suite to be mocked does not include\r\n    // any tests.\r\n    if (mode === 'mockResponse') {\r\n      let testSuite = _.find(userConf.testSuites, (suite) => { return suite.id == this.cmdOpts.testSuite; });\r\n      let parsedTestSuite = this.parseTestSuite(testSuite, testSuite.id, mode);\r\n      parsedTestSuites.set(parsedTestSuite.suiteID, parsedTestSuite);\r\n      this.logger.debug(this.parsedTestSuites, true);\r\n    } else {\r\n      userConf.testSuites.forEach((testSuite) => {\r\n        let suiteID = testSuite.id || uuidv1();\r\n        if (this.skipTestSuites && this.skipTestSuites.indexOf(suiteID)) {\r\n          this.logger.debug(`Skipping testSuite: ${suiteID}`);\r\n          return;\r\n        }\r\n\r\n        // parse this testSuite\r\n        let parsedTestSuite = this.parseTestSuite(testSuite, suiteID, mode);\r\n        parsedTestSuites.set(parsedTestSuite.suiteID, parsedTestSuite);\r\n        this.logger.debug(parsedTestSuites, true);\r\n      });\r\n    }\r\n\r\n\r\n    return this.parseTestFiles(parsedTestSuites, mode);\r\n  }\r\n\r\n  parseTestSuite(testSuite: TestSuiteConfig, suiteID: string, mode: string): ParsedTestSuite {\r\n    this.logger.debug(`parseTestSuite userConf testSuite ${suiteID} ${mode}`);\r\n\r\n    // create an id for this testSuite\r\n    console.log(JSON.stringify(testSuite, null, '\\t'));\r\n    return new ParsedTestSuite(testSuite, mode, this.testSet2EnvMap, this.env2TestSuiteMap);\r\n  }\r\n\r\n  /*\r\n    Discovers any test files, parses them, and inserts them into the testSuites/envs that they belong\r\n   */\r\n  parseTestFiles(parsedTestSuites: TypedMap<ParsedTestSuite>, mode: string) {\r\n      this.logger.debug(`parseFiles`);\r\n      this.logger.debug(this.env2TestSuiteMap, true);\r\n      this.logger.debug(this.testSet2EnvMap, true);\r\n      // build up a list of testFolders\r\n      let testFolders = [];\r\n      parsedTestSuites.values().map(pst => {\r\n        if (pst.testFolder) {\r\n          testFolders.push(path.join(this.filePaths.busybeeDir, pst.testFolder, '/**/*.json'));\r\n          testFolders.push(path.join(this.filePaths.busybeeDir, pst.testFolder, '/**/*.js'));\r\n        }\r\n      });\r\n\r\n      let files = glob.sync(`{${testFolders.join(',')}}`, {ignore:`${this.filePaths.userConfigFile}`});\r\n\r\n      // parse json files, compile testSets and add them to the conf.\r\n      this.logger.info(\"parsing files...\");\r\n      files.forEach((file: string) => {\r\n        // support for running specific tests files\r\n        if (this.testFiles && !_.find(this.testFiles, (fileName) => { return file.endsWith(fileName); })) {\r\n          this.logger.info(`skipping ${file}`);\r\n          return;\r\n        } else {\r\n          this.logger.info(`parsing ${file}`);\r\n        }\r\n\r\n        let tests;\r\n        if (file.endsWith('.js')) {\r\n          tests = require(file);\r\n        } else {\r\n          let data = fs.readFileSync(file, 'utf8');\r\n          tests = JSON.parse(data);\r\n        }\r\n\r\n        if (!Array.isArray(tests)) {\r\n          tests = [tests];\r\n        }\r\n\r\n        tests.forEach((test) => {\r\n          this.logger.debug(test);\r\n          test = new RESTTest(test);\r\n          if (test.skip) { return; }\r\n          if (mode == 'test') {\r\n            if (!test.expect || !test.expect.status || !test.expect.body) { return; }\r\n          }\r\n          if (mode == 'mock') {\r\n            test.testSet = { id: 'default' }\r\n          }\r\n\r\n          if (_.isUndefined(test.testSet)) {\r\n            this.logger.info(`test '${test.name}' does not contain required prop 'testSet'. Skipping`);\r\n\r\n            return;\r\n          }\r\n\r\n          // support multiple testSets\r\n          if (!Array.isArray(test.testSet)) {\r\n            test.testSet = [test.testSet];\r\n          }\r\n\r\n          // iterate each testSet entry for this test (1 test can run in multiple testSets)\r\n          test.testSet.forEach((testSetInfo) => {\r\n            // lookup the env that this TestSet is a member of\r\n            if (_.isUndefined(this.testSet2EnvMap.get(testSetInfo.id))) {\r\n              this.logger.warn(`Unable to identify the Test Environment containing the testSetId '${testSetInfo.id}'.`);\r\n              return;\r\n            }\r\n\r\n            let testEnvId = this.testSet2EnvMap.get(testSetInfo.id);\r\n\r\n            // lookup the suite that this env is a member of\r\n            if (_.isUndefined(this.env2TestSuiteMap.get(testEnvId))) {\r\n              this.logger.warn(`Unable to identify the Test Suite containing the envId ${testEnvId}.`);\r\n              return;\r\n            }\r\n\r\n            let suiteID = this.env2TestSuiteMap.get(testEnvId);\r\n            if (_.isUndefined(testSetInfo.index)) {\r\n              // push it on the end\r\n              parsedTestSuites.get(suiteID).testEnvs.get(testEnvId).testSets.get(testSetInfo.id).tests.push(test);\r\n              //conf.restApi.testEnvs[testEnvId].testSets[testSetInfo.id].tests.push(test);\r\n            } else {\r\n              // insert it at the proper index, fill any empty spots along the way\r\n              Array(testSetInfo.index + 1).fill(null).forEach((d,i) => {\r\n                if (i == testSetInfo.index) {\r\n                  parsedTestSuites.get(suiteID).testEnvs.get(testEnvId).testSets.get(testSetInfo.id).tests[i] = test;\r\n                } else {\r\n                  if (!parsedTestSuites.get(suiteID).testEnvs.get(testEnvId).testSets.get(testSetInfo.id).tests[i]) {\r\n                    parsedTestSuites.get(suiteID).testEnvs.get(testEnvId).testSets.get(testSetInfo.id).tests[i] = new RESTTest({});\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          });\r\n        });\r\n      });\r\n\r\n      return parsedTestSuites;\r\n  }\r\n\r\n  getLogLevel(cmdOpts: any) {\r\n    let logLevel;\r\n    if (process.env.BUSYBEE_DEBUG) {\r\n      logLevel = 'DEBUG';\r\n    } else if (process.env.BUSYBEE_LOG_LEVEL) {\r\n      if (Logger.isLogLevel(process.env.BUSYBEE_LOG_LEVEL)) {\r\n        logLevel = process.env.BUSYBEE_LOG_LEVEL;\r\n      }\r\n    } else if (cmdOpts) {\r\n      if (this.cmdOpts.debug) {\r\n        logLevel = 'DEBUG';\r\n      } else if (cmdOpts.logLevel) {\r\n        if (Logger.isLogLevel(cmdOpts.logLevel)) {\r\n          logLevel = cmdOpts.logLevel;\r\n        }\r\n      }\r\n    }\r\n\r\n    return logLevel;\r\n  }\r\n}\r\n"]}