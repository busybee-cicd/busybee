{"version":3,"file":"RESTSuiteManager.js","sourceRoot":"","sources":["../../../src/managers/RESTSuiteManager.ts"],"names":[],"mappings":"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","sourcesContent":["import * as _ from 'lodash';\r\nimport * as promiseTools from 'promise-tools';\r\nimport { Logger, LoggerConf } from 'busybee-util';\r\nimport { RESTClient } from '../lib/RESTClient';\r\nimport { SuiteEnvInfo } from '../lib/SuiteEnvInfo';\r\nimport { ParsedTestSetConfig } from '../models/config/parsed/ParsedTestSetConfig';\r\nimport { RESTTest } from '../models/RESTTest';\r\nimport { TestSetResult } from '../models/results/TestSetResult';\r\nimport { IgnoreKeys } from '../lib/assertionModifications/IgnoreKeys';\r\nimport { UnorderedCollections } from '../lib/assertionModifications/UnorderedCollections';\r\nimport { RESTTestPartResult } from '../models/results/RESTTestPartResult';\r\nimport { RESTTestHeaderResult } from '../models/results/RESTTestHeaderResult';\r\nimport { RESTTestResult } from '../models/results/RESTTestResult';\r\nimport { BusybeeParsedConfig } from '../models/config/BusybeeParsedConfig';\r\nimport { PromiseGeneratingFunction } from 'promise-tools';\r\n\r\n// support JSON.stringify on Error objects\r\nif (!('toJSON' in Error.prototype))\r\n  Object.defineProperty(Error.prototype, 'toJSON', {\r\n    value: function() {\r\n      var alt = {};\r\n\r\n      Object.getOwnPropertyNames(this).forEach(function(key) {\r\n        alt[key] = this[key];\r\n      }, this);\r\n\r\n      return alt;\r\n    },\r\n    configurable: true,\r\n    writable: true\r\n  });\r\n\r\nexport class RESTSuiteManager {\r\n  private conf: BusybeeParsedConfig;\r\n  private logger: Logger;\r\n  private restClient: RESTClient;\r\n\r\n  constructor(conf: BusybeeParsedConfig, suiteEnvConf: SuiteEnvInfo) {\r\n    this.conf = _.cloneDeep(conf);\r\n    const loggerConf = new LoggerConf(this, conf.logLevel, null);\r\n    this.logger = new Logger(loggerConf);\r\n    this.restClient = new RESTClient(conf, suiteEnvConf);\r\n  }\r\n\r\n  ///////// TestRunning\r\n\r\n  async runRESTApiTestSets(\r\n    currentEnv: SuiteEnvInfo\r\n  ): Promise<Array<TestSetResult>> {\r\n    // TODO: logic for running TestSets in order\r\n    this.logger.trace(\r\n      `runRESTApiTestSets ${currentEnv.suiteID} ${currentEnv.suiteEnvID}`\r\n    );\r\n    let testSetPromises = _.map(\r\n      currentEnv.testSets.values(),\r\n      (testSet: ParsedTestSetConfig) => {\r\n        return () => {\r\n          return this.runRESTApiTestSet(currentEnv, testSet);\r\n        }; // wrap promise in empty fn for promiseTools\r\n      }\r\n    );\r\n\r\n    try {\r\n      let testSetResults: Array<TestSetResult> = await promiseTools.parallel(\r\n        testSetPromises,\r\n        2\r\n      );\r\n      return testSetResults;\r\n    } catch (e) {\r\n      this.logger.trace(\r\n        `runRESTApiTestSets ERROR encountered while running testSetPromises`\r\n      );\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  async runRESTApiTestSet(\r\n    currentEnv: SuiteEnvInfo,\r\n    testSet: ParsedTestSetConfig\r\n  ): Promise<TestSetResult> {\r\n    this.logger.trace(`runRESTApiTestSet ${currentEnv.ports} ${testSet.id}`);\r\n\r\n    // build api test functions\r\n    if (!testSet.tests) {\r\n      throw new Error(`testSet ${testSet.id} has no tests`);\r\n    }\r\n\r\n    let testFns = this.buildTestTasks(currentEnv, testSet);\r\n\r\n    // run api test functions\r\n    this.logger.info(`Running Test Set: ${testSet.id}`);\r\n\r\n    if (testSet.description) {\r\n      this.logger.info(`${testSet.description}`);\r\n    }\r\n\r\n    let controlFlow = testSet.controlFlow || `series`;\r\n    this.logger.debug(`${testSet.id}: controlFlow = ${controlFlow}`);\r\n\r\n    try {\r\n      let testResults;\r\n\r\n      if (controlFlow === 'parallel') {\r\n        let limit = testSet.controlFlowLimit || 3;\r\n        testResults = await promiseTools.parallel(testFns, limit);\r\n      } else {\r\n        testResults = await promiseTools.series(testFns);\r\n      }\r\n\r\n      // see if any tests failed and mark the set according\r\n      let pass = _.find(testResults, (tr: any) => {\r\n        return tr.pass === false;\r\n      })\r\n        ? false\r\n        : true;\r\n\r\n      let testSetResult = new TestSetResult();\r\n      testSetResult.pass = pass;\r\n      testSetResult.id = testSet.id;\r\n      testSetResult.tests = testResults;\r\n\r\n      return testSetResult;\r\n    } catch (err) {\r\n      this.logger.trace('runRESTApiTestSet ERROR while running tests');\r\n      this.logger.trace(err);\r\n\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  buildTestTasks(currentEnv: SuiteEnvInfo, testSet: ParsedTestSetConfig) {\r\n    this.logger.trace(\r\n      `RESTSuiteManager:buildTestTasks <testSet> ${currentEnv.ports}`\r\n    );\r\n    this.logger.trace(testSet);\r\n\r\n    // filter out tests that do not contain .request object (shouldnt be required anymore) TODO: remove?\r\n    let testsWithARequest = _.reject(testSet.tests, (test: RESTTest) => {\r\n      if (_.isNil(test)) {\r\n        this.logger.trace('TestSet with NULL test detected');\r\n      }\r\n      return _.isNil(test);\r\n    });\r\n\r\n    return _.map(testsWithARequest, (test: RESTTest) => {\r\n      return async () => {\r\n        // build request\r\n        let port = currentEnv.ports[0]; // the REST api port should be passed first in the userConfigFile.\r\n        let opts = this.restClient.buildRequest(test.request, port);\r\n        // filter everything in the request opts for variables that should be set via variableExports\r\n        this.logger.trace(\r\n          'opts before processRequestOptsForVariableDeclarations'\r\n        );\r\n        this.logger.trace(opts);\r\n        opts = this.processRequestOptsForVariableDeclarations(\r\n          opts,\r\n          testSet.variableExports\r\n        );\r\n        this.logger.trace(\r\n          'opts after processRequestOptsForVariableDeclarations'\r\n        );\r\n        this.logger.trace(opts);\r\n\r\n        // figure out if this test is running at a specific index. (just nice for consoling)\r\n        let testIndex;\r\n        if (_.isUndefined(test.testSet)) {\r\n          testIndex = '#';\r\n        } else {\r\n          // we have more than one testSet configuration for this test. find the one\r\n          // matching the current testSet\r\n          let testSetConf = test.testSet;\r\n          if (Array.isArray(testSetConf)) {\r\n            testSetConf = _.find(testSetConf, c => {\r\n              return c.id == testSet.id;\r\n            });\r\n          }\r\n\r\n          if (_.isUndefined(testSetConf.index)) {\r\n            testIndex = '#';\r\n          } else {\r\n            testIndex = testSetConf.index;\r\n          }\r\n        }\r\n\r\n        this.logger.info(`${testSet.id}: ${testIndex}: ${test.id}`);\r\n        if (test.delayRequest) {\r\n          this.logger.info(\r\n            `Delaying request for ${test.delayRequest / 1000} second(s)`\r\n          );\r\n          await this.wait(test.delayRequest);\r\n        }\r\n\r\n        try {\r\n          let response = await this.makeRequestWithRetries(opts, 0, 3);\r\n          return await this.validateTestResult(\r\n            testSet,\r\n            test,\r\n            Object.assign({}, this.restClient.getDefaultRequestOpts(), opts),\r\n            response\r\n          );\r\n        } catch (err) {\r\n          this.logger.error(err, true);\r\n          // TODO: refactor a lot of this testResult building logic for re-use w/ the validation section\r\n          let testResult = new RESTTestResult(test.id);\r\n          testResult.pass = false;\r\n          if (test.expect.status) {\r\n            testResult.status = new RESTTestPartResult();\r\n            testResult.status.pass = false;\r\n            testResult.status.expected = test.expect.status;\r\n          }\r\n          if (test.expect.headers) {\r\n            testResult.headers = new RESTTestHeaderResult();\r\n            testResult.headers.pass = false;\r\n            _.forEach(test.expect.headers, (v, headerName) => {\r\n              let expected = {};\r\n              expected[headerName] = v;\r\n              testResult.headers.expected.push(expected);\r\n            });\r\n          }\r\n          if (test.expect.body) {\r\n            testResult.body = new RESTTestPartResult();\r\n            testResult.body.pass = false;\r\n            testResult.body.expected = test.expect.body;\r\n            testResult.body.error = {\r\n              type: 'error during request',\r\n              error: err.message,\r\n              stack: err.stack\r\n            };\r\n          }\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  async makeRequestWithRetries(opts, retries, retryMax) {\r\n    try {\r\n      return await this.restClient.makeRequest(opts);\r\n    } catch (err) {\r\n      if (retries > retryMax) {\r\n        this.logger.error(`REST request retry attempts exceeded`);\r\n        throw err;\r\n      } else {\r\n        retries += 1;\r\n        this.logger.warn(\r\n          `REST request failed unexpectedly, retry attempt ${retries}`\r\n        );\r\n        await this.wait(2000);\r\n        return await this.makeRequestWithRetries(opts, retries, retryMax);\r\n      }\r\n    }\r\n  }\r\n\r\n  wait(milliseconds) {\r\n    this.logger.debug(`wait ${milliseconds / 1000} second(s)`);\r\n    return new Promise(resolve => setTimeout(resolve, milliseconds));\r\n  }\r\n\r\n  /*\r\n   Iterates through the request opts and relaces all instances of #{myVar}\r\n   with properties of the same name on variableExports\r\n   */\r\n  processRequestOptsForVariableDeclarations(\r\n    opts: any,\r\n    variableExports: any\r\n  ): any {\r\n    // check url\r\n    opts.url = this.replaceVars(opts.url, variableExports);\r\n    let objBasedPropsToCheck = ['qs', 'headers', 'body'];\r\n    objBasedPropsToCheck.forEach(prop => {\r\n      if (opts[prop]) {\r\n        opts[prop] = this.replaceVarsInObject(opts[prop], variableExports);\r\n      }\r\n    });\r\n\r\n    return opts;\r\n  }\r\n\r\n  replaceVarsInObject(obj: any, variableExports: any) {\r\n    if (_.isString(obj)) {\r\n      return this.replaceVars(obj, variableExports);\r\n    }\r\n\r\n    _.forEach(obj, (value, propName) => {\r\n      if (_.isObject(value) && !_.isArray(value)) {\r\n        obj[propName] = this.replaceVarsInObject(value, variableExports);\r\n      } else if (_.isArray(value)) {\r\n        obj[propName] = value.map(v => {\r\n          return this.replaceVarsInObject(v, variableExports);\r\n        });\r\n      } else if (_.isString(value)) {\r\n        obj[propName] = this.replaceVars(value, variableExports);\r\n      }\r\n    });\r\n\r\n    return obj;\r\n  }\r\n\r\n  /*\r\n   Parses strings formatted as \"#{myVar}\"\r\n   */\r\n  replaceVars(str: string, variableExports: any) {\r\n    this.logger.trace('replaceVars: current variableExports ->');\r\n    this.logger.trace(variableExports, true);\r\n    // When the string startsWith #{ and endswith }\r\n    // we assume its a literal substitution. ie) no coercion, not an object, not interpolated\r\n    if (str.startsWith(`#{`) && str.endsWith(`}`)) {\r\n      let varName = str.substr(2).slice(0, -1);\r\n      this.logger.trace;\r\n      this.logger.trace(\r\n        `Setting literal ${variableExports[varName]} for '${varName}'`\r\n      );\r\n      return variableExports[varName];\r\n    }\r\n\r\n    let replaced = str.replace(/#{\\w+}/g, match => {\r\n      match = match.substr(2).slice(0, -1); // remove #{}\r\n      this.logger.trace(`Setting ${match} for '${str}'`);\r\n      this.logger.trace(variableExports, true);\r\n      if (_.isObject(variableExports[match])) {\r\n        // if the matched variable's value is an object\r\n        // we return a special instruction\r\n        return `OBJECT-${match}`;\r\n      }\r\n      return variableExports[match];\r\n    });\r\n\r\n    if (replaced.startsWith('OBJECT')) {\r\n      // set the key's value equal to an object stored in variableExports\r\n      let key = replaced.substr(7);\r\n      replaced = variableExports[key];\r\n    }\r\n\r\n    return replaced;\r\n  }\r\n\r\n  async validateTestResult(\r\n    testSet: ParsedTestSetConfig,\r\n    test: RESTTest,\r\n    reqOpts: any,\r\n    res\r\n  ) {\r\n    this.logger.trace(`validateTestResult`);\r\n\r\n    // validate results\r\n    let testResult = new RESTTestResult(test.id);\r\n\r\n    if (test.expect.status) {\r\n      testResult.status = new RESTTestPartResult();\r\n      let statusPass = res.statusCode == test.expect.status;\r\n      testResult.status.actual = res.statusCode;\r\n\r\n      if (!statusPass) {\r\n        testResult.pass = false;\r\n        testResult.status.pass = false;\r\n        testResult.status.expected = test.expect.status;\r\n      }\r\n    }\r\n    // else {\r\n    //   // return the actual status by default\r\n    //   testResult.status.actual = res.statusCode;\r\n    // }\r\n\r\n    if (test.expect.headers) {\r\n      testResult.headers = new RESTTestHeaderResult();\r\n      _.forEach(test.expect.headers, (v, headerName) => {\r\n        if (res.headers[headerName] != v) {\r\n          testResult.pass = false;\r\n          testResult.headers.pass = false;\r\n        }\r\n\r\n        let actual = {};\r\n        actual[headerName] = res.headers[headerName];\r\n        testResult.headers.actual.push(actual);\r\n        let expected = {};\r\n        expected[headerName] = v;\r\n        testResult.headers.expected.push(expected);\r\n      });\r\n    }\r\n    // else {\r\n    //   // return the actual headers by default\r\n    //   _.forEach(res.headers, (v, headerName) => {\r\n    //     let actual = {};\r\n    //     actual[headerName] = v;\r\n    //     testResult.headers.actual.push(actual);\r\n    //   });\r\n    // }\r\n\r\n    if (test.expect.body) {\r\n      testResult.body = new RESTTestPartResult();\r\n      let bodyPass = true;\r\n      let customFnErr = null;\r\n\r\n      ///////////////////////////\r\n      //  Run Assertions\r\n      ///////////////////////////\r\n\r\n      let actual = _.cloneDeep(res.body);\r\n      let expected;\r\n      try {\r\n        //  Assertion Modifications\r\n\r\n        /*\r\n         there are some assertion modifications that should alter the actual/expect prior to running an\r\n         assertion function or doing a direct pojo comparision. run those here\r\n         */\r\n        if (_.isFunction(test.expect.body)) {\r\n          /*\r\n           In the event that 'expect.body' is a custom fn, we'll make 'expected' == 'actual'\r\n           assertionModification logic relies on 'expected' and 'actual' to both be objects.\r\n           Ultimately, when the assertions are run the 'expected' object set here will not\r\n           be used and instead 'test.expect.body(actual)' will be evaluated.\r\n           */\r\n          expected = _.cloneDeep(actual);\r\n        } else {\r\n          expected = _.cloneDeep(test.expect.body);\r\n        }\r\n\r\n        if (test.expect.assertionModifications) {\r\n          testResult.assertionModifications =\r\n            test.expect.assertionModifications;\r\n\r\n          if (test.expect.assertionModifications.ignoreKeys) {\r\n            IgnoreKeys.process(\r\n              test.expect.assertionModifications.ignoreKeys,\r\n              expected,\r\n              actual,\r\n              this.logger\r\n            );\r\n          }\r\n\r\n          if (test.expect.assertionModifications.unorderedCollections) {\r\n            this.logger.debug(`Processing UnorderedCollections`);\r\n            /*\r\n             Due to the scenario where unorderedCollections may contain unorderedCollections ie)\r\n             [\r\n             {\r\n             subCollection: [1,2,3,4]\r\n             },\r\n             {\r\n             subCollection: [5,6,7,8]\r\n             }\r\n             ]\r\n\r\n             We must do a first pass where we work from the outside -> in. We just check for equality while ignoring nested collections.\r\n             On a second pass we remove the collections so that they don't appear in the body-assertion steps below\r\n             */\r\n            UnorderedCollections.process(\r\n              test.expect.assertionModifications.unorderedCollections,\r\n              expected,\r\n              actual\r\n            );\r\n          }\r\n        }\r\n        // /End Assertion Modifications\r\n\r\n        // IMPORTANT: the 'expected' and 'actual' at this point have been modified to remove anything that we should ignore.\r\n        // that is so that keys that don't matter aren't passed to the assertionFn or the _.isEqual\r\n\r\n        // Run Custom Function Assertion OR basic Pojo comparision\r\n        if (_.isFunction(test.expect.body)) {\r\n          // if the test has a custom function for assertion, run it.\r\n          let bodyResult = test.expect.body(actual, testSet.variableExports);\r\n          if (bodyResult === false) {\r\n            bodyPass = false;\r\n          } // else we pass it. ie) it doesn't return anything we assume it passed.\r\n        } else {\r\n          // substitue any exported variable referenced from previous tests\r\n          if (!_.isEmpty(testSet.variableExports)) {\r\n            this.replaceVarsInObject(expected, testSet.variableExports);\r\n          }\r\n          // assert the body against the provided pojo body\r\n          bodyPass = _.isEqual(expected, actual);\r\n        }\r\n      } catch (e) {\r\n        bodyPass = false;\r\n        customFnErr = {\r\n          type: 'custom validation function',\r\n          error: e.message,\r\n          stack: e.stack\r\n        };\r\n      }\r\n\r\n      testResult.body.actual = actual;\r\n      if (!bodyPass) {\r\n        testResult.pass = false;\r\n        testResult.body.pass = false;\r\n        if (!_.isFunction(test.expect.body)) {\r\n          testResult.body.expected = expected;\r\n        }\r\n        if (customFnErr) {\r\n          testResult.body.error = customFnErr;\r\n        }\r\n      }\r\n    }\r\n    // else {\r\n    //   // just return the body that was returned and consider it a pass\r\n    //   testResult.body.actual = _.cloneDeep(res.body);\r\n    // }\r\n\r\n    // attach the request info for reporting purposes\r\n    testResult.request = reqOpts;\r\n\r\n    return testResult;\r\n  }\r\n}\r\n"]}