{"version":3,"file":"ConfigParser.js","sourceRoot":"","sources":["../../../src/lib/ConfigParser.ts"],"names":[],"mappings":";;AAAA,uBAAyB;AACzB,mCAAgC;AAChC,iEAAmD;AACnD,iEAA8D;AAC9D,qEAAkE;AAClE,oEAAiE;AAEjE;IAQE,sBAAY,OAAO;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,iCAAe,CAAC,OAAO,CAAC,CAAC;QAC9C,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAC1C,IAAI,CAAC,MAAM,GAAG,IAAI,eAAM,CAAC,EAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAC,EAAE,IAAI,CAAC,CAAC;IAC5D,CAAC;IAED,kCAAW,GAAX,UAAY,OAAO;QACjB,IAAI,QAAQ,CAAC;QACb,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC;YAC9B,QAAQ,GAAG,OAAO,CAAC;QACrB,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACzC,EAAE,CAAC,CAAC,eAAM,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;gBACrD,QAAQ,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC;YAC3C,CAAC;QACH,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;YACnB,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;gBACvB,QAAQ,GAAG,OAAO,CAAC;YACrB,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC5B,EAAE,CAAC,CAAC,eAAM,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;oBACxC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;gBAC9B,CAAC;YACH,CAAC;QACH,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,QAAQ,CAAC;QACzC,MAAM,CAAC,QAAQ,CAAC;IAClB,CAAC;IAED,4BAAK,GAAL,UAAM,IAAI;QACR,IAAI,UAAU,GAAG,oCAAW,CAAC,qCAAiB,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;QACpH,IAAI,CAAC,YAAY,GAAG,IAAI,yCAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QAC5E,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAEH,mBAAC;AAAD,CAAC,AA3CD,IA2CC;AA3CY,oCAAY","sourcesContent":["import * as fs from 'fs';\r\nimport {Logger} from './Logger';\r\nimport {deserialize} from 'json-typescript-mapper';\r\nimport {BusybeeUserConfig} from \"../config/BusybeeUserConfig\";\r\nimport {BusybeeParsedConfig} from \"../config/BusybeeParsedConfig\";\r\nimport {FilePathsConfig} from \"../config/parsed/FilePathsConfig\";\r\n\r\nexport class ConfigParser {\r\n\r\n  private cmdOpts: any;\r\n  private logLevel: string;\r\n  private logger: Logger;\r\n  private parsedConfig: BusybeeParsedConfig;\r\n  private filePaths: FilePathsConfig;\r\n\r\n  constructor(cmdOpts) {\r\n    this.filePaths = new FilePathsConfig(cmdOpts);\r\n    this.cmdOpts = cmdOpts;\r\n    this.logLevel = this.getLogLevel(cmdOpts);\r\n    this.logger = new Logger({logLevel: this.logLevel}, this);\r\n  }\r\n\r\n  getLogLevel(cmdOpts) {\r\n    let logLevel;\r\n    if (process.env.BUSYBEE_DEBUG) {\r\n      logLevel = 'DEBUG';\r\n    } else if (process.env.BUSYBEE_LOG_LEVEL) {\r\n      if (Logger.isLogLevel(process.env.BUSYBEE_LOG_LEVEL)) {\r\n        logLevel = process.env.BUSYBEE_LOG_LEVEL;\r\n      }\r\n    } else if (cmdOpts) {\r\n      if (this.cmdOpts.debug) {\r\n        logLevel = 'DEBUG';\r\n      } else if (cmdOpts.logLevel) {\r\n        if (Logger.isLogLevel(cmdOpts.logLevel)) {\r\n          logLevel = cmdOpts.logLevel;\r\n        }\r\n      }\r\n    }\r\n\r\n    process.env.BUSYBEE_LOG_LEVEL = logLevel;\r\n    return logLevel;\r\n  }\r\n\r\n  parse(mode): BusybeeParsedConfig {\r\n    let userConfig = deserialize(BusybeeUserConfig, JSON.parse(fs.readFileSync(this.filePaths.userConfigFile, 'utf8')));\r\n    this.parsedConfig = new BusybeeParsedConfig(userConfig, this.cmdOpts, mode);\r\n    return this.parsedConfig;\r\n  }\r\n\r\n}\r\n"]}